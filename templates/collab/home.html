{% extends "base.html" %}
{% load static %}   <!-- ✅ static 태그 로딩 추가 -->

{% block title %}방 목록 · CodingLine{% endblock %}

{% block content %}
<!-- 모바일 검색 -->
<form action="{% url 'home' %}" method="get" class="search search--mobile">
  <input name="q" value="{{ q }}" placeholder="방 검색" class="search__input" />
</form>

<!-- 미니멀 헤더 -->
<header class="head">
  <div class="head__title">codingline</div>
  <p class="head__desc">음악 대신 <b>방 정보</b>를 공유하는 공간입니다.</p>
</header>

<div class="grid">
  <!-- 좌: 방 생성 -->
  <section class="col col--left">
    <div class="card">
      <h2 class="card__title">새 방 만들기</h2>
      <form action="{% url 'home' %}" method="post" class="form">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <label class="field">
          <span class="field__label">방 제목</span>
          {{ form.Romname }}
          {{ form.Romname.errors }}
        </label>

        <label class="field">
          <span class="field__label">주제</span>
          {{ form.topic }}
          {{ form.topic.errors }}
        </label>

        <label class="field">
          <span class="field__label">암호</span>
          {{ form.password }}
          {{ form.password.errors }}
        </label>

        <label class="check">
          {{ form.is_private }} <span>비공개</span>
        </label>

        <label class="field">
          <span class="field__label">정원</span>
          {{ form.capacity }}
          {{ form.capacity.errors }}
        </label>

        <button class="btn btn--brand">만들기</button>
      </form>
    </div>
  </section>

  <!-- 우: 방 목록 -->
  <section class="col col--right">
    <div class="list__head">
      <h2 class="card__title">방 목록</h2>
      {% if q %}<span class="muted">“{{ q }}” 검색 결과</span>{% endif %}
    </div>

    <!-- ✅ id="room-list" 추가 -->
    <ul id="room-list" class="list">
      {% for r in rooms %}
        {% if not r.is_private or q %}
        <!-- ✅ 각 방 li에 id 부여 -->
        <li id="room-{{ r.id }}" class="item" data-room-slug="{{ r.slug }}">
          <div class="item__left">
            <div class="item__thumb">🏠</div>
            <div>
              <div class="item__title font-medium">{{ r.Romname }}</div>
              <div class="item__meta">
                주제: {{ r.topic }} · 생성: {{ r.created_at|date:"Y-m-d H:i" }}
                · 방장: {{ r.created_by.display_name|default:r.created_by.username }}
                {% if r.password %} · 🔒{% endif %}
                {% if r.is_private %} · (비공개){% endif %}
              </div>
            </div>
          </div>
          <a href="{% url 'room-detail' r.slug %}"
             class="link enter-btn"
             data-slug="{{ r.slug }}"
             {% if r.password %}data-locked="1"{% endif %}>입장</a>
        </li>
        {% endif %}
      {% empty %}
        <li class="muted">표시할 방이 없습니다.</li>
      {% endfor %}
    </ul>

    <!-- 비밀번호 배너 -->
    <div id="pwBanner" class="pw">
      <div class="pw__box">
        <div class="pw__row">
          <strong id="pwBannerTitle">비밀번호 입력</strong>
          <input id="pwBannerInput" type="password" class="pw__input" placeholder="방 비밀번호" />
          <button id="pwBannerSubmit" class="btn btn--brand">입장</button>
          <button id="pwBannerClose"  class="btn">닫기</button>
        </div>
        <p id="pwBannerErr" class="pw__err hidden"></p>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'js/home.js' %}"></script>
{% endblock %}
